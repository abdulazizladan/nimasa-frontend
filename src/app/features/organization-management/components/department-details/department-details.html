<div class="department-details-container page-container" *ngIf="department">

    @if (departmentDetails(); as department) {
    <div fxLayout.xs="column" fxLayout.gt-xs="row" class="card-gap">

        <mat-card class="section-card overview-card" fxFlex.gt-xs="320px">
            <mat-card-header>
                <mat-card-title class="department-name">{{ department.name }}</mat-card-title>
                <mat-card-subtitle>Code: {{ department.code }}</mat-card-subtitle>
            </mat-card-header>
            <mat-card-content>
                <p class="department-description">{{ department.description || 'No detailed description available.' }}
                </p>
            </mat-card-content>
        </mat-card>

        <mat-card class="section-card contact-card" fxFlex.gt-xs fxLayout="column" class="card-gap">
            <mat-card-header>
                <mat-card-title>Department Head: {{ department.head }}</mat-card-title>
            </mat-card-header>
            <mat-card-content class="contact-info">
                <div class="contact-item">
                    <mat-icon>phone</mat-icon>
                    <span>{{ department.contactPhone || 'N/A' }}</span>
                </div>
                <div class="contact-item">
                    <mat-icon>email</mat-icon>
                    <span>{{ department.directorEmail || 'N/A' }}</span>
                </div>
            </mat-card-content>
        </mat-card>
    </div>
    } @else {
    <mat-card class="section-card">
        <mat-card-content>
            @if(store.isLoading()){<div class="loading-state">
                <mat-progress-bar diameter="30"></mat-progress-bar>
                <p>Loading department details...</p>
            </div>}
            @if (!store.isLoading()) {
            <p class="error-state">
                Department not found or data is unavailable.
            </p>
            }
        </mat-card-content>
    </mat-card>
    }

    <hr class="section-spacing">

    <div class="section-header mb-lg">
        <h2>Department Goal Summary</h2>
        <div fxLayout="row">
            <span fxFlex="1 1 auto"></span>
            <button mat-flat-button [routerLink]="['/admin/organization/department', department.code, 'performance']">
                View department performance
            </button>
        </div>
    </div>
    <div class="metrics-grid mb-2xl">

        <mat-card class="metric-card achieved">
            <mat-card-content fxLayout="column" class="card-gap">
                <div class="metric-value">{{ department.metrics.achievedGoals }}</div>
                <div class="metric-label">Achieved Goals</div>
            </mat-card-content>
        </mat-card>

        <mat-card class="metric-card not-achieved">
            <mat-card-content fxLayout="column" class="card-gap">
                <div class="metric-value">{{ department.metrics.notAchievedGoals }}</div>
                <div class="metric-label">Not Achieved</div>
            </mat-card-content>
        </mat-card>

        <mat-card class="metric-card in-progress">
            <mat-card-content fxLayout="column" class="card-gap">
                <div class="metric-value">{{ department.metrics.inProgressGoals }}</div>
                <div class="metric-label">In Progress</div>
            </mat-card-content>
        </mat-card>

        <mat-card class="metric-card not-done">
            <mat-card-content fxLayout="column" class="card-gap">
                <div class="metric-value">{{ department.metrics.notDoneGoals }}</div>
                <div class="metric-label">Not Done</div>
            </mat-card-content>
        </mat-card>
    </div>

    <hr class="section-spacing">

    <h2 class="mb-lg">Assigned Tasks</h2>
    <table mat-table [dataSource]="tasks" class="mat-elevation-z4 tasks-table">

        <ng-container matColumnDef="taskName">
            <th mat-header-cell *matHeaderCellDef> Task </th>
            <td mat-cell *matCellDef="let task"> {{ task.name }} </td>
        </ng-container>

        <ng-container matColumnDef="assignedTo">
            <th mat-header-cell *matHeaderCellDef> Assigned To </th>
            <td mat-cell *matCellDef="let task"> {{ task.assignedTo }} </td>
        </ng-container>

        <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef> Status </th>
            <td mat-cell *matCellDef="let task">
                <mat-chip-row [ngClass]="getChipClass(task.status)">
                    {{ task.status | uppercase }}
                </mat-chip-row>
            </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

        <tr class="mat-row" *matNoDataRow>
            <td class="mat-cell" [attr.colspan]="displayedColumns.length">
                No tasks currently assigned to this department.
            </td>
        </tr>
    </table>
</div>