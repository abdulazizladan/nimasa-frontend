<!--<div 
  fxLayout="row" 
  fxLayout.lt-sm="column"  fxLayoutAlign="start stretch"
  fxLayoutGap="20px"  fxLayoutGap.lt-sm="10px" class="kpi-cards-row"
>

  <mat-card fxFlex class="kpi-card kpi-total">
    <mat-card-title>Total Departments</mat-card-title>
    <mat-card-content>{{ store.totalDepartments() }}</mat-card-content>
  </mat-card>
  <mat-card fxFlex class="kpi-card kpi-active">
    <mat-card-title>Active Units</mat-card-title>
    <mat-card-content>0</mat-card-content>
    </mat-card>
  <mat-card fxFlex class="kpi-card kpi-targets">
    <mat-card-title>Targets Set</mat-card-title>
    <mat-card-content>0</mat-card-content>
    </mat-card>
  <mat-card fxFlex class="kpi-card kpi-performance">
    <mat-card-title>Avg. Performance</mat-card-title>
    <mat-card-content>0</mat-card-content>
    </mat-card>
</div>

<div style="height: 30px;"></div>

<h2 class="table-title">NIMSA Departments Overview</h2>


<table mat-table [dataSource]="dataSource" class="mat-elevation-z4 departments-table">

  <ng-container matColumnDef="code">
    <th mat-header-cell *matHeaderCellDef> Code </th>
    <td mat-cell *matCellDef="let element"> {{element.code}} </td>
  </ng-container>

  <ng-container matColumnDef="name">
    <th mat-header-cell *matHeaderCellDef> Department Name </th>
    <td mat-cell *matCellDef="let element"> {{element.name}} </td>
  </ng-container>

  <ng-container matColumnDef="head">
    <th mat-header-cell *matHeaderCellDef> Head of Department </th>
    <td mat-cell *matCellDef="let element"> {{element.head}} </td>
  </ng-container>

  <ng-container matColumnDef="action">
    <th mat-header-cell *matHeaderCellDef> Action </th>
    <td mat-cell *matCellDef="let element">
      <button mat-icon-button [routerLink]="['./department', element.code]">
        <mat-icon>visibility</mat-icon>
      </button>
    </td>
  </ng-container>

  <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
  <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

  <tr class="mat-row" *matNoDataRow>
    <td class="mat-cell" colspan="3">No departments found.</td>
  </tr>
</table>

@if (store.isLoading()) {
  <mat-progress-bar mode="query"></mat-progress-bar>
}

@if (store.error()) {
  <div class="error">{{ store.error() }}</div>
}-->


<div class="min-h-screen bg-gray-50 font-sans antialiased">
  <mat-toolbar color="primary" class="shadow-lg sticky top-0 z-10 h-16">
    <mat-icon class="mr-2 hidden sm:inline">corporate_fare</mat-icon>
    <span class="text-xl font-semibold">Organizational Data Dashboard</span>
    <span class="flex-grow"></span>
    <button mat-button class="hidden sm:inline">
      <mat-icon class="mr-1">settings</mat-icon> Admin
    </button>
  </mat-toolbar>

  <div class="container mx-auto p-4 sm:p-6 lg:p-8">

    <!-- Loading Bar Simulation -->
    @if (isLoading()) {
      <mat-progress-bar mode="indeterminate" class="fixed top-16 left-0 right-0 z-20"></mat-progress-bar>
    }

    <!-- Agency Header Card -->
    <mat-card class="mb-8 p-0 rounded-xl shadow-2xl overflow-hidden transition duration-300 hover:shadow-3xl">
      <div class="p-6 bg-white dark:bg-gray-800">
        <div class="flex flex-col sm:flex-row items-start sm:items-center">
          <img [src]="agency().logo" alt="Agency Logo" class="w-20 h-20 rounded-full object-cover mr-4 mb-4 sm:mb-0 border-4 border-blue-500 shadow-md">
          <div class="flex-grow">
            <h2 class="text-3xl sm:text-4xl font-extrabold text-blue-700 dark:text-blue-400 leading-tight">
              {{ agency().name }} ({{ agency().code }})
            </h2>
            <p class="text-lg text-gray-600 dark:text-gray-400 italic mt-1">
              {{ agency().motto || 'Motto not available' }}
            </p>
          </div>
          <div class="mt-4 sm:mt-0 flex-shrink-0">
            <!--<mat-chip-listbox>
              <mat-chip [color]="agency().isActive ? 'primary' : 'warn'" [selected]="agency().isActive">
                @if (agency().isActive) {
                  <mat-icon matChipAvatar>check_circle</mat-icon>
                  Active
                } @else {
                  <mat-icon matChipAvatar>cancel</mat-icon>
                  Inactive
                }
              </mat-chip>
            </mat-chip-listbox>-->
          </div>
        </div>

        <mat-divider class="my-4"></mat-divider>

        <!-- Metadata Grid -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-gray-700 dark:text-gray-300">
          <div class="flex items-center">
            <mat-icon color="accent" class="mr-2">apartment</mat-icon>
            <span class="font-semibold">Total Departments:</span>
            <span class="ml-2 font-mono text-blue-600 dark:text-blue-300">{{ departmentsCount() }}</span>
          </div>
          <div class="flex items-center">
            <mat-icon color="accent" class="mr-2">info</mat-icon>
            <span class="font-semibold">Code:</span>
            <span class="ml-2">{{ agency().code }}</span>
          </div>
          <div class="flex items-center">
            <mat-icon color="accent" class="mr-2">update</mat-icon>
            <span class="font-semibold">Status:</span>
            <span class="ml-2">{{ agency().isActive ? 'Operational' : 'On Hold' }}</span>
          </div>
        </div>
      </div>
    </mat-card>

    <!-- Departments Table Card -->
    <mat-card class="rounded-xl shadow-xl p-0">
      <mat-card-header class="p-6">
        <mat-card-title class="text-2xl font-bold text-gray-800 dark:text-white">
          Departments Listing
        </mat-card-title>
        <mat-card-subtitle class="text-gray-500">
          Overview of all functional and administrative units.
        </mat-card-subtitle>
      </mat-card-header>

      <mat-divider></mat-divider>

      <div class="overflow-x-auto">
        <table mat-table [dataSource]="agency().departments" class="w-full min-w-[700px] dark:bg-gray-900 mat-elevation-z8">

          <!-- Code Column -->
          <ng-container matColumnDef="code">
            <th mat-header-cell *matHeaderCellDef class="font-bold text-left">Code</th>
            <td mat-cell *matCellDef="let element" class="font-mono text-blue-600 dark:text-blue-400">
              {{ element.code }}
            </td>
          </ng-container>

          <!-- Name Column -->
          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef class="font-bold text-left">Department Name</th>
            <td mat-cell *matCellDef="let element" class="font-semibold text-gray-800 dark:text-white">
              {{ element.name }}
            </td>
          </ng-container>

          <!-- Head Column -->
          <ng-container matColumnDef="head">
            <th mat-header-cell *matHeaderCellDef class="font-bold text-left">Director/Head</th>
            <td mat-cell *matCellDef="let element" class="text-sm">
              <div class="flex items-center">
                <mat-icon class="mr-2 text-gray-500" [fontSet]="'material-icons-outlined'">person</mat-icon>
                <span>{{ element.head }}</span>
              </div>
            </td>
          </ng-container>

          <!-- Description Column -->
          <ng-container matColumnDef="description">
            <th mat-header-cell *matHeaderCellDef class="font-bold text-left hidden lg:table-cell">Description</th>
            <td mat-cell *matCellDef="let element" class="text-xs text-gray-500 italic hidden lg:table-cell">
              {{ element.description || 'No formal description provided.' }}
            </td>
          </ng-container>

          <!-- Actions Column -->
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef class="font-bold text-center">Actions</th>
            <td mat-cell *matCellDef="let element" class="text-center">
              <button mat-icon-button color="accent" aria-label="View details">
                <mat-icon>visibility</mat-icon>
              </button>
              <button mat-icon-button color="primary" aria-label="Edit department">
                <mat-icon>edit</mat-icon>
              </button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="hover:bg-blue-50 dark:hover:bg-gray-700 transition duration-150"></tr>

          <!-- Row shown when there is no data -->
          <tr class="mat-row" *matNoDataRow>
            <td class="mat-cell text-center p-4 text-lg text-gray-500" [attr.colspan]="displayedColumns.length">
              No departments found.
            </td>
          </tr>
        </table>
      </div>
    </mat-card>
  </div>
</div>